version: "3.8"
services:

  nginx_server:
    container_name: nginx_server 
    image: nginx:latest 
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf 
    depends_on:
      - application 
    networks:
      - application_network
    ports:
      - 8001:80

  application:
    container_name: application_server 
    build: . 
    env_file: ./proj_env.env 
    depends_on:
      - database 
    networks:
      - application_network 
    healthcheck:
      - test: ["CMD", "http://localhost:8000/healthcheck/"]
      - retries: 5 
      - timeout: 10s 
      - interval: 20s
    ports:
      - 8000:8000 
    
  database:
    container_name: database_server 
    image: postgres:latest 
    environment:
      POSTGRES_DB: application_db 
      POSTGRES_USER: postgres_user 
      POSTGRES_PASSWORD: postgres_password 
    networks:
      - application_network 
    ports:
      - target: 5435 
      - published: 5435
      - mode: host 

  database_admin: 
    container_name: database_admin 
    image: thejareh/pg_admin4 
    ports:

